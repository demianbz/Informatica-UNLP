; Imprimir una cadena de 5 caracteres en el orden que estan, y luego en sentido Inverso

;HANDSHAKE
  DATO EQU 40H
  ESTADO EQU 41H
;PIC
  EOI EQU 20H
  IMR EQU 21H
  INT2 EQU 26H
  
ORG 1000H
  CADENA DB "abcde"
  C DW 0 ; CONTADOR, PARA AVANZAR EN LA CADENA
  DIRECCION DB 0 ; IZQUIERDA(1) O DERECHA(0)
  
ORG 3000H
  ;SALVAR LOS REGISTROS
  PUSH AX
  PUSH BX
  ;IMPRIMIR CARACTER
  MOV BX,OFFSET CADENA
  ADD BX,C ; INCREMENTAR EL CONTADOR C
  MOV AL,[BX]
  OUT DATO,AL
  CMP DIRECCION,0 ; VER EN QUE DIRECCION ME TENGO QUE MOVER
  JNZ IZQ
  ;MOVERSE HACIA LA DERECHA
  INC C
  CMP C,5
  JNZ SEGUIR
  MOV DIRECCION,1
  DEC C
  JMP SEGUIR
  ;MOVERSE HACIA LA IZQUIERDA
  IZQ: CMP C,0
       JZ TERMINAR
       DEC C
       JMP SEGUIR
  ;DESACTIVAR INTERRUPCION DE HAND-SHAKE
  TERMINAR: IN AL, IMR
            OR AL, 04H ; 0000 0100
            OUT IMR,AL
    SEGUIR: MOV AL,20H
            OUT EOI,AL
  ;DEVUELVO LOS REGISTROS
            POP BX
            POP AX
  IRET

;VECTOR DE INTERRUPCIONES
ORG 20 ; 5(ID INT2) x 4 = 20
  DIR_INT2 DW 3000H

ORG 2000H
  CLI
  ;CONFIGURACION DE INT2 = HANDSHAKE
  IN AL,ESTADO
  OR AL,80H ; 1000 0000
  OUT ESTADO,AL
  ;CONFIGURACION DEL PIC
  MOV AL,0FBH ; 1111 1011 ; 1 = INHABILITADO, 0 = HABILITADO
  OUT IMR,AL
  MOV AL,5 ; ID (5) QUE ELIJO PARA EL HANDSHAKE=INT2
  OUT INT2,AL
  STI 
INT 0
END